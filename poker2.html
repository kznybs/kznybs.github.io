<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Poker Manager</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&family=Teko:wght@400;600&display=swap" rel="stylesheet">

    <style>
        /* --- CSS EMBUTIDO DIRETAMENTE AQUI --- */
        :root {
            --bg-dark: #111827;
            --bg-card: #1F2937;
            --bg-accent: #374151;
            --text-light: #E5E7EB;
            --text-medium: #9CA3AF;
            --text-dark: #111827;
            --primary: #38BDF8;
            --green: #34D399;
            --red: #F87171;
            --red-dark: #DC2626;
            --yellow: #FBBF24;
            --blue: #3B82F6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-light);
            font-family: 'Roboto Mono', monospace;
            padding: 1rem;
        }

        .hidden { display: none !important; }

        .container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .card {
            background-color: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .card-title {
            font-family: 'Teko', sans-serif;
            font-size: 1.8rem;
            text-align: center;
            color: #FFF;
            margin-bottom: 1rem;
            letter-spacing: 1px;
        }

        /* --- Timer --- */
        .timer-display { font-family: 'Teko', sans-serif; font-size: 4rem; font-weight: 700; color: var(--primary); text-align: center; line-height: 1; }
        .blinds-info { display: flex; justify-content: space-around; text-align: center; margin: 1rem 0; }
        .info-label { font-size: 0.8rem; color: var(--text-medium); }
        .info-value { font-family: 'Teko', sans-serif; font-size: 2rem; color: #FFF; line-height: 1; }
        .timer-controls { display: flex; flex-wrap: wrap; justify-content: center; align-items: center; gap: 0.5rem; }
        .input-group { display: flex; align-items: center; gap: 0.5rem; background-color: var(--bg-accent); padding: 0.5rem 1rem; border-radius: 8px; }
        .input-group label { font-size: 0.9rem; }
        .input-group input { background: none; border: none; color: #FFF; font-size: 1rem; width: 40px; text-align: center; }
        .input-group input:focus { outline: none; }
        
        .btn { border: none; border-radius: 8px; padding: 0.5rem 1rem; font-weight: bold; cursor: pointer; transition: all 0.2s ease; width: 100%; font-size: 1rem; margin-top: 0.5rem; }
        .btn-sm { padding: 0.4rem 0.8rem; font-size: 0.8rem; width: auto; }
        .btn-start { background-color: #2563EB; color: white; }
        .btn-pause { background-color: var(--yellow); color: var(--text-dark); }
        .btn-reset-timer { background-color: var(--red); color: white; }
        .btn-skip { background-color: var(--bg-accent); color: white; }
        .btn-skip:disabled { background-color: #2a3340; color: #566172; cursor: not-allowed; }

        /* --- Jogadores e Pote --- */
        .pot-container { text-align: center; margin-bottom: 1rem; }
        .pot-label { font-family: 'Teko', sans-serif; font-size: 2rem; color: var(--text-medium); }
        .pot-value { font-family: 'Teko', sans-serif; font-size: 3.5rem; color: var(--green); line-height: 1; }
        .btn-distribute { background-color: var(--green); color: var(--text-dark); }
        .btn-manage-chips { background-color: var(--blue); color: white; }
        .btn-reset-all { background-color: var(--red-dark); color: white; }

        .player-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; }
        .player-card { background-color: var(--bg-accent); border-radius: 12px; padding: 1rem; text-align: center; cursor: pointer; transition: transform 0.2s ease; }
        .player-card:active { transform: scale(0.95); }
        .player-name { font-weight: bold; font-size: 1.1rem; }
        .player-stack { font-size: 1.5rem; color: var(--primary); font-weight: bold; }

        /* --- Overlays --- */
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.8); display: flex; justify-content: center; align-items: center; padding: 1rem; z-index: 100; }
        .overlay-content { background-color: var(--bg-card); padding: 1.5rem; border-radius: 16px; width: 100%; max-width: 500px; max-height: 90vh; overflow-y: auto; }
        
        .chip-selection-list { display: flex; flex-direction: column; gap: 1rem; margin: 1.5rem 0; }
        .chip-selection-item { display: flex; justify-content: space-between; align-items: center; }
        .chip-info { display: flex; align-items: center; gap: 1rem; }
        .chip-display { width: 40px; height: 40px; border-radius: 20px; display: flex; justify-content: center; align-items: center; font-weight: bold; border: 3px solid; }
        .chip-white { background-color: #E5E7EB; border-color: #9CA3AF; color: #111827; }
        .chip-red { background-color: #EF4444; border-color: #B91C1C; color: white; }
        .chip-green { background-color: #22C55E; border-color: #15803D; color: white; }
        .chip-black { background-color: #374151; border-color: #111827; color: white; }
        .chip-blue { background-color: #3B82F6; border-color: #1D4ED8; color: white; }
        
        .chip-controls { display: flex; align-items: center; gap: 1rem; }
        .chip-control-btn { width: 35px; height: 35px; border-radius: 50%; border: none; font-size: 1.5rem; font-weight: bold; color: white; cursor: pointer; }
        .btn-decrease { background-color: var(--red); }
        .btn-increase { background-color: var(--green); }
        .chip-count { font-size: 1.2rem; font-weight: bold; min-width: 30px; text-align: center; }

        .overlay-actions { display: flex; gap: 1rem; margin-top: 1.5rem; }
        .btn-confirm { flex: 1; background-color: var(--primary); color: var(--text-dark); }
        .btn-cancel { flex: 1; background-color: var(--bg-accent); color: white; }
        
        #player-selection-grid { display: flex; flex-direction: column; gap: 1rem; }
        .confirm-dialog-text { text-align: center; font-size: 1.1rem; margin-bottom: 1.5rem; }
    </style>
</head>
<body>
    <!-- Tela Principal -->
    <div id="main-view">
        <div class="container">
            <div class="card">
                <h1 class="card-title">TIMER DOS BLINDS</h1>
                <div id="timer-display" class="timer-display">25:00</div>
                <div class="blinds-info">
                    <div class="info-block">
                        <p class="info-label">RODADA</p>
                        <p id="round-display" class="info-value">1</p>
                    </div>
                    <div class="info-block">
                        <p class="info-label">BLINDS</p>
                        <p id="blinds-display" class="info-value">25 / 50</p>
                    </div>
                </div>
                <div class="timer-controls">
                    <button id="prev-round-btn" class="btn btn-sm btn-skip" disabled>&lt; Ant.</button>
                    <div class="input-group">
                        <label for="timer-input">Min:</label>
                        <input type="number" id="timer-input" value="25">
                    </div>
                    <button id="next-round-btn" class="btn btn-sm btn-skip" disabled>Próx. &gt;</button>
                </div>
                 <div class="timer-controls" style="margin-top: 1rem;">
                    <button id="start-pause-btn" class="btn btn-sm btn-start">INICIAR</button>
                    <button id="reset-timer-btn" class="btn btn-sm btn-reset-timer">RESETAR</button>
                </div>
            </div>

            <div class="card">
                <div class="pot-container">
                    <p class="pot-label">POTE</p>
                    <p id="pot-value" class="pot-value">0</p>
                </div>
                <div id="player-grid" class="player-grid"></div>
                <button id="distribute-pot-btn" class="btn btn-distribute">Distribuir Pote</button>
                <button id="manage-chips-btn" class="btn btn-manage-chips">Gerenciar Fichas</button>
                <button id="reset-all-btn" class="btn btn-reset-all">Resetar Fichas de Todos</button>
            </div>
        </div>
    </div>

    <!-- Overlays (Ocultos por padrão) -->
    <div id="betting-view" class="overlay hidden">
        <div class="overlay-content">
            <h2 id="betting-player-name" class="card-title">Apostar</h2>
            <div id="bet-chip-list" class="chip-selection-list"></div>
            <div class="overlay-actions">
                <button id="cancel-bet-btn" class="btn btn-cancel">Cancelar</button>
                <button id="confirm-bet-btn" class="btn btn-confirm">Apostar</button>
            </div>
        </div>
    </div>

    <div id="manage-chips-view" class="overlay hidden">
        <div class="overlay-content">
            <h2 id="manage-chips-player-name" class="card-title">Gerenciar Fichas</h2>
            <div id="manage-chip-list" class="chip-selection-list"></div>
            <div class="overlay-actions">
                <button id="cancel-manage-chips-btn" class="btn btn-cancel">Cancelar</button>
                <button id="confirm-manage-chips-btn" class="btn btn-confirm">Confirmar</button>
            </div>
        </div>
    </div>

    <div id="player-selection-view" class="overlay hidden">
        <div class="overlay-content">
            <h2 id="player-selection-title" class="card-title">Selecione o Jogador</h2>
            <div id="player-selection-grid"></div>
            <button id="cancel-player-selection-btn" class="btn btn-cancel" style="width:100%; margin-top: 1rem;">Cancelar</button>
        </div>
    </div>

    <div id="reset-confirm-view" class="overlay hidden">
        <div class="overlay-content">
            <h2 class="card-title">Atenção</h2>
            <p class="confirm-dialog-text">Você tem certeza que deseja resetar as fichas de todos os jogadores para o valor inicial?</p>
            <div class="overlay-actions">
                <button id="cancel-reset-all-btn" class="btn btn-cancel">Cancelar</button>
                <button id="confirm-reset-all-btn" class="btn btn-confirm" style="background-color: var(--red-dark);">Confirmar</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- CONFIGURAÇÃO E ESTADO INICIAL ---
            const CHIP_TYPES = {
                white: { name: 'Branca', value: 200, class: 'chip-white' },
                red: { name: 'Vermelha', value: 25, class: 'chip-red' },
                green: { name: 'Verde', value: 25, class: 'chip-green' },
                black: { name: 'Preta', value: 50, class: 'chip-black' },
                blue: { name: 'Azul', value: 400, class: 'chip-blue' } // Ficha azul adicionada
            };
            const BLIND_LEVELS = [
                { small: 25, big: 50 }, { small: 50, big: 100 }, { small: 75, big: 150 },
                { small: 100, big: 200 }, { small: 150, big: 300 }, { small: 200, big: 400 },
            ];
            
            let players = [];
            let pot = 0;
            let chipSelection = {};
            let activePlayerId = null;
            let playerSelectionCallback = null;

            let timerInterval = null;
            let timeRemaining = 25 * 60;
            let isPaused = true;
            let currentRound = 0;

            // --- ELEMENTOS DO DOM ---
            const mainView = document.getElementById('main-view');
            const bettingView = document.getElementById('betting-view');
            const manageChipsView = document.getElementById('manage-chips-view');
            const playerSelectionView = document.getElementById('player-selection-view');
            const resetConfirmView = document.getElementById('reset-confirm-view');
            
            const timerDisplay = document.getElementById('timer-display');
            const roundDisplay = document.getElementById('round-display');
            const blindsDisplay = document.getElementById('blinds-display');
            const timerInput = document.getElementById('timer-input');
            const startPauseBtn = document.getElementById('start-pause-btn');
            const resetTimerBtn = document.getElementById('reset-timer-btn');
            const prevRoundBtn = document.getElementById('prev-round-btn');
            const nextRoundBtn = document.getElementById('next-round-btn');

            const playerGrid = document.getElementById('player-grid');
            const potValueEl = document.getElementById('pot-value');
            const distributePotBtn = document.getElementById('distribute-pot-btn');
            const manageChipsBtn = document.getElementById('manage-chips-btn');
            const resetAllBtn = document.getElementById('reset-all-btn');

            const cancelBetBtn = document.getElementById('cancel-bet-btn');
            const cancelManageChipsBtn = document.getElementById('cancel-manage-chips-btn');
            const cancelPlayerSelectionBtn = document.getElementById('cancel-player-selection-btn');
            const confirmBetBtn = document.getElementById('confirm-bet-btn');
            const confirmManageChipsBtn = document.getElementById('confirm-manage-chips-btn');

            // --- FUNÇÕES DE INICIALIZAÇÃO E RENDERIZAÇÃO ---
            function initializeGame() {
                pot = 0;
                players = [];
                for (let i = 1; i <= 6; i++) {
                    players.push({
                        id: i,
                        name: `Jogador ${i}`,
                        // Ficha azul começa com 0
                        chips: { white: 8, red: 8, green: 8, black: 8, blue: 0 },
                    });
                }
                renderAll();
            }

            function calculatePlayerStack(player) {
                return Object.keys(player.chips).reduce((total, chipType) => total + (player.chips[chipType] * CHIP_TYPES[chipType].value), 0);
            }

            function renderAll() {
                playerGrid.innerHTML = '';
                players.forEach(player => {
                    const stackValue = calculatePlayerStack(player);
                    const playerEl = document.createElement('div');
                    playerEl.className = 'player-card';
                    playerEl.dataset.playerId = player.id;
                    playerEl.innerHTML = `<div class="player-name">${player.name}</div><div class="player-stack">${stackValue.toLocaleString('pt-BR')}</div>`;
                    playerGrid.appendChild(playerEl);
                });
                potValueEl.textContent = pot.toLocaleString('pt-BR');
            }

            // --- LÓGICA DE JOGO E OVERLAYS ---
            function openPlayerSelection(title, callback) {
                playerSelectionCallback = callback;
                document.getElementById('player-selection-title').textContent = title;
                const grid = document.getElementById('player-selection-grid');
                grid.innerHTML = '';
                players.forEach(player => {
                    const btn = document.createElement('button');
                    btn.className = 'btn player-card';
                    btn.dataset.playerId = player.id;
                    btn.innerHTML = `<div class="player-name">${player.name}</div> <div class="player-stack">${calculatePlayerStack(player).toLocaleString('pt-BR')}</div>`;
                    grid.appendChild(btn);
                });
                mainView.classList.add('hidden');
                playerSelectionView.classList.remove('hidden');
            }

            function showBettingView(playerId) {
                activePlayerId = playerId;
                const player = players.find(p => p.id === playerId);
                if (!player) return;
                chipSelection = {};
                document.getElementById('betting-player-name').textContent = `Apostar - ${player.name}`;
                const list = document.getElementById('bet-chip-list');
                list.innerHTML = '';
                Object.keys(CHIP_TYPES).forEach(chipType => list.appendChild(createChipSelectorItem(chipType, { maxAmount: player.chips[chipType], showAvailable: true })));
                mainView.classList.add('hidden');
                bettingView.classList.remove('hidden');
            }
            
            function showManageChipsView(playerId) {
                activePlayerId = playerId;
                const player = players.find(p => p.id === playerId);
                chipSelection = {};
                document.getElementById('manage-chips-player-name').textContent = `Gerenciar Fichas - ${player.name}`;
                const list = document.getElementById('manage-chip-list');
                list.innerHTML = '';
                Object.keys(CHIP_TYPES).forEach(chipType => list.appendChild(createChipSelectorItem(chipType, { showAvailable: true, maxAmount: Infinity })));
                mainView.classList.add('hidden');
                manageChipsView.classList.remove('hidden');
            }

            function createChipSelectorItem(chipType, options = {}) {
                const { maxAmount = Infinity, showAvailable = false } = options;
                const chipInfo = CHIP_TYPES[chipType];
                const itemEl = document.createElement('div');
                itemEl.className = 'chip-selection-item';
                const availableText = showAvailable ? `<span>No Jogador: ${maxAmount}</span>` : '';
                itemEl.innerHTML = `
                    <div class="chip-info">
                        <div class="chip-display ${chipInfo.class}">${chipInfo.value}</div>
                        ${availableText}
                    </div>
                    <div class="chip-controls">
                        <button class="chip-control-btn btn-decrease" data-chip-type="${chipType}">-</button>
                        <span id="select-count-${chipType}" class="chip-count">0</span>
                        <button class="chip-control-btn btn-increase" data-chip-type="${chipType}">+</button>
                    </div>
                `;
                chipSelection[chipType] = 0;
                return itemEl;
            }

            function handleBetChipSelection(chipType, amount) {
                const player = players.find(p => p.id === activePlayerId);
                const newAmount = (chipSelection[chipType] || 0) + amount;
                if (newAmount >= 0 && newAmount <= player.chips[chipType]) {
                    chipSelection[chipType] = newAmount;
                    bettingView.querySelector(`#select-count-${chipType}`).textContent = newAmount;
                }
            }

            function handleManageChipSelection(chipType, amount) {
                const player = players.find(p => p.id === activePlayerId);
                const newAmount = (chipSelection[chipType] || 0) + amount;
                // Prevent removing more chips than the player has
                if (player.chips[chipType] + newAmount < 0) {
                    return;
                }
                chipSelection[chipType] = newAmount;
                manageChipsView.querySelector(`#select-count-${chipType}`).textContent = newAmount;
            }
            
            function closeAllOverlays() {
                [mainView, bettingView, manageChipsView, playerSelectionView, resetConfirmView].forEach(v => v.classList.add('hidden'));
                mainView.classList.remove('hidden');
                activePlayerId = null;
                playerSelectionCallback = null;
            }

            // --- EVENT LISTENERS ---
            playerGrid.addEventListener('click', e => {
                const card = e.target.closest('.player-card');
                if (card) showBettingView(parseInt(card.dataset.playerId));
            });
            
            document.getElementById('bet-chip-list').addEventListener('click', e => {
                const btn = e.target.closest('.chip-control-btn');
                if (btn) {
                    const chipType = btn.dataset.chipType;
                    const amount = btn.classList.contains('btn-increase') ? 1 : -1;
                    handleBetChipSelection(chipType, amount);
                }
            });
            
            document.getElementById('manage-chip-list').addEventListener('click', e => {
                const btn = e.target.closest('.chip-control-btn');
                if (btn) {
                    const chipType = btn.dataset.chipType;
                    const amount = btn.classList.contains('btn-increase') ? 1 : -1;
                    handleManageChipSelection(chipType, amount);
                }
            });

            confirmBetBtn.addEventListener('click', () => {
                const player = players.find(p => p.id === activePlayerId);
                let betValue = 0;
                Object.keys(chipSelection).forEach(chipType => {
                    player.chips[chipType] -= chipSelection[chipType];
                    betValue += chipSelection[chipType] * CHIP_TYPES[chipType].value;
                });
                pot += betValue;
                closeAllOverlays();
                renderAll();
            });
            
            confirmManageChipsBtn.addEventListener('click', () => {
                const player = players.find(p => p.id === activePlayerId);
                Object.keys(chipSelection).forEach(chipType => {
                    player.chips[chipType] += chipSelection[chipType];
                });
                closeAllOverlays();
                renderAll();
            });

            distributePotBtn.addEventListener('click', () => {
                if (pot > 0) openPlayerSelection('Quem ganhou o pote?', (winnerId) => {
                    const winner = players.find(p => p.id === winnerId);
                    let remainingPot = pot;
                    const sortedChips = Object.entries(CHIP_TYPES).sort((a,b) => b[1].value - a[1].value);
                    sortedChips.forEach(([type, info]) => {
                        const numChips = Math.floor(remainingPot / info.value);
                        if (numChips > 0) {
                            winner.chips[type] += numChips;
                            remainingPot -= numChips * info.value;
                        }
                    });
                    if (remainingPot > 0) winner.chips.red += 1;
                    pot = 0;
                    closeAllOverlays();
                    renderAll();
                });
            });

            manageChipsBtn.addEventListener('click', () => {
                openPlayerSelection('Gerenciar fichas para:', (playerId) => {
                    closeAllOverlays();
                    showManageChipsView(playerId);
                });
            });

            resetAllBtn.addEventListener('click', () => {
                mainView.classList.add('hidden');
                resetConfirmView.classList.remove('hidden');
            });
            document.getElementById('confirm-reset-all-btn').addEventListener('click', () => {
                initializeGame();
                closeAllOverlays();
            });

            document.getElementById('player-selection-grid').addEventListener('click', e => {
                const card = e.target.closest('.player-card');
                if (card && playerSelectionCallback) {
                    playerSelectionCallback(parseInt(card.dataset.playerId));
                }
            });

            [cancelBetBtn, cancelManageChipsBtn, cancelPlayerSelectionBtn, document.getElementById('cancel-reset-all-btn')].forEach(btn => btn.addEventListener('click', closeAllOverlays));

            // --- LÓGICA DO TIMER ---
            function updateTimerUI() {
                timerDisplay.textContent = formatTime(timeRemaining);
                const level = BLIND_LEVELS[currentRound];
                roundDisplay.textContent = currentRound + 1;
                blindsDisplay.textContent = level ? `${level.small} / ${level.big}`: 'FIM';
                prevRoundBtn.disabled = !isPaused || currentRound === 0;
                nextRoundBtn.disabled = !isPaused || currentRound >= BLIND_LEVELS.length - 1;
            }
            function formatTime(s) { return `${String(Math.floor(s/60)).padStart(2,'0')}:${String(s%60).padStart(2,'0')}`; }
            function playSound() { try { if (navigator.vibrate) navigator.vibrate([200,100,200]); const a=new(window.AudioContext||window.webkitAudioContext)(),o=a.createOscillator();o.type='sine';o.frequency.setValueAtTime(880,a.currentTime);o.connect(a.destination);o.start();setTimeout(()=>o.stop(),500); } catch(e){} }
            function levelUp() { if (currentRound < BLIND_LEVELS.length - 1) { currentRound++; timeRemaining = parseInt(timerInput.value)*60; playSound(); } else { isPaused=true; clearInterval(timerInterval); startPauseBtn.textContent='FIM'; startPauseBtn.disabled=true; } updateTimerUI(); }
            function levelDown() { if (currentRound > 0) { currentRound--; timeRemaining = parseInt(timerInput.value)*60; } updateTimerUI(); }
            function handleStartPause() { if(isPaused){isPaused=false;startPauseBtn.textContent='PAUSAR';startPauseBtn.className='btn btn-sm btn-pause';timerInput.disabled=true;timerInterval=setInterval(()=>{if(timeRemaining>0)timeRemaining--;else levelUp();updateTimerUI();},1000);}else{isPaused=true;clearInterval(timerInterval);startPauseBtn.textContent='CONTINUAR';startPauseBtn.className='btn btn-sm btn-start';}updateTimerUI(); }
            function resetTimer() { isPaused=true;clearInterval(timerInterval);currentRound=0;timeRemaining=parseInt(timerInput.value)*60;timerInput.disabled=false;startPauseBtn.disabled=false;startPauseBtn.textContent='INICIAR';startPauseBtn.className='btn btn-sm btn-start';updateTimerUI(); }
            
            startPauseBtn.addEventListener('click', handleStartPause);
            resetTimerBtn.addEventListener('click', resetTimer);
            nextRoundBtn.addEventListener('click', levelUp);
            prevRoundBtn.addEventListener('click', levelDown);
            timerInput.addEventListener('change', () => { if (isPaused) { timeRemaining = parseInt(timerInput.value)*60; updateTimerUI(); } });

            // --- INICIALIZAÇÃO DO JOGO ---
            initializeGame();
            updateTimerUI();
        });
    </script>
</body>
</html>
